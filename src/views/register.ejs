<!DOCTYPE html>
<html>
    <head>
        <%-include('./partials/head') %>   
        <link rel="stylesheet" href="/css/styleRegister.css">          
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300&display=swap" rel="stylesheet">

		<style type="text/css">

      *{
        font-family: 'Jost', sans-serif !important;
      }

			#form{
        width: 75%;
        margin: auto;
        margin-top:10px;
        margin-bottom: 50px;      
        box-shadow: 0 0 6px 0 rgba(255, 255, 255, 0.8);
        border-radius: 10px;
        border:1px solid;
        padding: 3% 5%;
        background: #f8f9f9;                
      }
      .group{                        
        margin-top:25px;
        /*border:1px solid red;*/
        width: 100%;
      }

      .inputText{
        background: none;
        color:#c6c6c6;        
        padding: 6px;
        display: block;        
        border: none;
        border-bottom: 1px solid #49454567;
        width: 100%;
      }

      .inputText:focus{
        outline: none;
        color:#5e4d5d;
      }      

      .inputText:focus~label,
      .inputText:valid~label{
        top:-14px;
        font-size: 12px;
        color:#2196f3;
      }

      .barra{
        position: relative;
        display: block;
        width: 100%;
      }

      .barra::before{
        content: "";
        height: 2px;
        width: 0%;
        bottom: 0;
        position: absolute;
        background: linear-gradient(to right, #860301, #222);
        transition: 0.3s ease width;
        left: 0;
      }

      .inputText:focus~.barra::before{
          width: 100%;
      }

      .error{
        color:#880200;
      }

      @media screen and (max-width:500px){
          #form{
              width: 80%;
          }
      }
		</style>
        
    </head>
    <body>
    	<%-include('./partials/header') %>    	 		
  			<form action="" method="POST" id="form" enctype="multipart/form-data">
          <div class="group">
            <label for="">Nombre y Apellido</label>
            <input class="inputText" type="text" name="nombre" id="nombre" placeholder="Ingrese su nombre" required><span class="barra"></span>
            <% if(locals.error && error.nombre ){ %>
              <p class="error"> <%= error.nombre.msg %> </p>
            <% } %>  
              <p class="error" id = 'nombreError'> </p>            
          </div>          
          <div class="group">
            <label for="">Email</label>
            <input class="inputText" type="email" name="email" id="email" placeholder="tuemail@dominio.com" required><span class="barra"></span>
            <% if(locals.error && error.email){ %>
              <p class="error"> <%= error.email.msg %> </p>
            <% } %>
              <p class="error" id = 'errorMail'> </p>                  
          </div>
          <div class="group">
            <label for="">Telefono</label>
            <input class="inputText" type="number" name="telefono" id="telefono" placeholder="####-####" required><span class="barra"></span>            
            <% if(locals.error && error.telefono){ %>
            <p class="error"> <%= error.telefono.msg %> </p>
          <% } %>
            <p class="error" id = 'telefonoError'> </p>
          </div>
          <div class="group">
            <label for="">Fecha de nacimiento</label>
            <input class="inputText" type="date" name="fechaDeNacimiento" id="birth_date" required><span class="barra"></span> <% if(locals.error && error.fechaDeNacimiento){ %>
              <p class="error"> <%= error.fechaDeNacimiento.msg %> </p>
            <% } %>
              <p class="error" id = 'errorEdad'> </p>           
          </div>    
          <div class="group">
            <label for="">Foto de Usuario</label>
            <input class="inputText" type="file" name="img" accept=".jpg, .png" required><span class="barra"></span>            
          </div>    
          <div class="group">
            <label for="">Elige tu contraseña</label>
            <input class="inputText" type="password" name="contraseña" id="contraseña" required><span class="barra"></span>
            <% if(locals.error && error.contraseña){ %>
              <p class="error"> <%= error.contraseña.msg %> </p>
            <% } %>
              <p class="error" id = 'errorPassword'> </p>            
          </div>
          <div class="group">
            <label for="contraseñaConfirm"> repite tu contraseña</label>
            <input type="password" name="contraseñaConfirm" id = 'contraseñaConfirm' placeholder="Confirmá tu contraseña" class="inputText"><span class="barra"></span>
            <% if(locals.error && error.contraseñaConfirm){ %>
              <p class="error"> <%= error.contraseñaConfirm.msg %> </p>
            <% } %>
               <p class="error" id = 'errorPasswordC'> </p>
            </div>
            <div class = "group">
              <label for="guardarCook"> Guardar Cuenta</label>
              <input type="checkbox" name="guardarCook">
            </div>
            <button type="submit" class="button crear" id="enviar">CREAR</button>
              <label class="cuentaRegistrada">¿Ya tenes una cuenta? <a href="/login">Inicia Sesión</a></label>
                <div class="redes">
                    <input class="Facebook" type="submit" value="Ingresar con Facebook">
                    <input class="Google" type="submit" value="Ingresar con Google">
               </div>
          
        </form>    	
    	<%-include('./partials/footer') %>    	
      <script>
        const enviar = document.getElementById('enviar');

    let nombre = document.querySelector('#nombre');
    let email = document.querySelector('#email');
    let telefono = document.querySelector('#telefono');
    let fechaNacimiento = document.querySelector('#birth_date');
    let password = document.querySelector('#contraseña');
    let passwordConfirm = document.querySelector('#contraseñaConfirm');

    let n, em, t, fn, p, pc = false;
    let validate = [];



    nombre.addEventListener('blur', e => {
        let error = document.querySelector('#nombreError');
        let numerror = 0
        if(nombre.value==''){
            error.innerText = 'Campo Requerido';
        }else{
            if(nombre.value.length < 5){ 
                error.innerText = 'El nombre debe contener por lo menos 5 letras \n';
                numerror ++;                
                return;
            }else{
                numerror --;
                error.innerHTML = ''
                n=true;                                                
            }

            if(!nombre.value.includes(',')){
                error.innerText += 'No se incluye la separacion con , del nombre y apellido'
                numerror ++
            }else if(numerror > 1){
                error.innerText = error.split(',')[0];  
                n=true;
                validate.push(n)                                
            }    
        }
        
    })

    email.addEventListener('blur', e => {
        const validateEmail = (email) => {
            return String(email)
              .toLowerCase()
              .match(
                /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
              );
          };
          let error = document.querySelector('#errorMail');
          if(email.value==''){
            error.innerText = 'Campo Requerido';
          }else{

            if (!validateEmail(email.value)){
                error.innerText = "No se cumple con el formato de un mail convencional";
                //console.log(!validateEmail(email.value));
            }else{
                //console.log(!validateEmail(email.value));
                error.innerText = '';
                em=true;
                validate.push(em)                                

            }
          }

          
    })    

    telefono.addEventListener('blur', e => {
        let error = document.querySelector('#telefonoError');
        if(telefono.value==''){
            error.innerText = 'Campo Requerido';
        }else{
            if(telefono.value.length < 7){
                error.innerText = 'El telefono tiene que contener 8 numeros';
            }else{
                error.innerText = '';
                t = true;
                validate.push(t);
            }
        }
        
    })    

    fechaNacimiento.addEventListener('blur', e => {
        let fechaActual = new Date()
        let error = document.querySelector('#errorEdad')
        console.log(`anio enviado: ${parseInt(fechaNacimiento.value.split('-')[0])} anio actual: ${parseInt(fechaActual.getFullYear())} entonces la edad actual es de ${parseInt(fechaActual.getFullYear()) - parseInt(fechaNacimiento.value.split('-')[0]) }`);
        if(parseInt(fechaActual.getFullYear()) - parseInt(fechaNacimiento.value.split('-')[0]) < 18){
            error.innerText = 'Solo se pueden registrar mayores de edad';
        }else{
            error.innerText = '';
            fn = true;
            validate.push(fn);
        }
    })    

    password.addEventListener('blur', e => {
        let error = document.querySelector('#errorPassword')
        if(password.value==''){
            error.innerText='Campo Requerido';
        }else{
            if(password.value.length < 8){
                error.innerText = 'La contraseña debe contener al menos 8 caracteres'
            }else{
                error.innerText = ""
                p=true;
                validate.push(p);

            }    
        }
        
    })   
    passwordConfirm.addEventListener('blur', e => {
        let error = document.querySelector('#errorPasswordC')
        if(password.value==''){
            error.innerText='Campo Requerido';
        }else{
            if(password.value != passwordConfirm.value ){
                error.innerText = 'Las contraseñas no son las mismas'
            }else{
                error.innerText = ""
                pc = true;
                validate.push(pc);
            }
        }        

    }) 

    enviar.onclick = function (){
    console.log(validate);
    //return false;

    if(validate.length>=6){
        alert("enviado");
        nombre.value='';        
        email.value='';        
        telefono.value='';
        fechaNacimiento.value='';
        password.value='';
        passwordConfirm.value='';
        validate = [];
        return false;
    }else{
        alert("algun campo esta vacio o corregirse")
        return false;
    }

   }  
      </script>
        <!--<script src="/js/register.js"></script>-->

    </body>
</html>